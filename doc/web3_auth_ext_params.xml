<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
	"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" [

<!-- Include general documentation entities -->
<!ENTITY % docentities SYSTEM "../../../../doc/docbook/entities.xml">
%docentities;

]>

<section id="web3_auth_ext.parameters" xmlns:xi="http://www.w3.org/2001/XInclude">

    <title>Parameters</title>
    
    <section id="web3_auth_ext.parameter_summary">
	<title>Parameter Summary</title>
	<para>
	    <table frame="all">
		<title>web3_auth_ext Module Parameters</title>
		<tgroup cols="4" align="left" colsep="1" rowsep="1">
		    <thead>
			<row>
			    <entry>Parameter</entry>
			    <entry>Type</entry>
			    <entry>Default</entry>
			    <entry>Description</entry>
			</row>
		    </thead>
		    <tbody>
			<row>
			    <entry>authentication_rpc_url</entry>
			    <entry>string</entry>
			    <entry>https://testnet.sapphire.oasis.dev</entry>
			    <entry>Oasis Sapphire RPC endpoint for authentication contracts</entry>
			</row>
			<row>
			    <entry>authentication_contract_address</entry>
			    <entry>string</entry>
			    <entry>0xE773BB79689379d32Ad1Db839868b6756B493aea</entry>
			    <entry>Authentication contract address on Oasis Sapphire</entry>
			</row>
			<row>
			    <entry>ens_rpc_url</entry>
			    <entry>string</entry>
			    <entry>https://ethereum-sepolia-rpc.publicnode.com</entry>
			    <entry>RPC endpoint for ENS queries (optional)</entry>
			</row>
			<row>
			    <entry>ens_registry_address</entry>
			    <entry>string</entry>
			    <entry>0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e</entry>
			    <entry>ENS Registry contract address</entry>
			</row>
			<row>
			    <entry>ens_name_wrapper_address</entry>
			    <entry>string</entry>
			    <entry>0x0635513f179D50A207757E05759CbD106d7dFcE8</entry>
			    <entry>ENS Name Wrapper contract address</entry>
			</row>
			<row>
			    <entry>contract_debug_mode</entry>
			    <entry>integer</entry>
			    <entry>1</entry>
			    <entry>Enable debug logging (0=off, 1=on)</entry>
			</row>
			<row>
			    <entry>rpc_timeout</entry>
			    <entry>integer</entry>
			    <entry>10</entry>
			    <entry>RPC call timeout in seconds</entry>
			</row>
		    </tbody>
		</tgroup>
	    </table>
	</para>
    </section>

    <section id="web3_auth_ext.p.authentication_rpc_url">
	<title><varname>authentication_rpc_url</varname> (string)</title>
	<para>
		RPC URL for the Oasis Sapphire network endpoint. Used for authentication 
		contract calls via eth_call method.
	</para>
	<para>
		<emphasis>Supported Networks:</emphasis>
		<itemizedlist>
			<listitem><para>Oasis Sapphire Testnet: https://testnet.sapphire.oasis.dev</para></listitem>
			<listitem><para>Oasis Sapphire Mainnet: https://sapphire.oasis.io</para></listitem>
		</itemizedlist>
	</para>
	<para>
		<emphasis>Environment Variable:</emphasis> AUTHENTICATION_RPC_URL
	</para>
	<para>
		<emphasis>Default:</emphasis> "https://testnet.sapphire.oasis.dev"
	</para>
	<example>
	    <title>authentication_rpc_url parameter</title>
	    <programlisting>
modparam("web3_auth_ext", "authentication_rpc_url", "https://sapphire.oasis.io")
	    </programlisting>
	</example>
    </section>

    <section id="web3_auth_ext.p.authentication_contract_address">
	<title><varname>authentication_contract_address</varname> (string)</title>
	<para>
		Smart contract address on Oasis Sapphire that handles authentication.
		Must implement authenticateUser() and getWalletAddress() functions.
	</para>
	<para>
		<emphasis>Required Contract Interface:</emphasis>
		<programlisting>
function authenticateUser(
    string memory username,
    string memory realm, 
    string memory method,
    string memory uri,
    string memory nonce,
    uint8 algorithm,
    bytes memory response
) public view returns (bool)

function getWalletAddress(
    string memory username
) public view returns (address)
		</programlisting>
	</para>
	<para>
		<emphasis>Environment Variable:</emphasis> AUTHENTICATION_CONTRACT_ADDRESS
	</para>
	<para>
		<emphasis>Default:</emphasis> "0xE773BB79689379d32Ad1Db839868b6756B493aea"
	</para>
	<example>
	    <title>authentication_contract_address parameter</title>
	    <programlisting>
modparam("web3_auth_ext", "authentication_contract_address", "0x1234567890abcdef1234567890abcdef12345678")
	    </programlisting>
	</example>
    </section>

    <section id="web3_auth_ext.p.ens_rpc_url">
	<title><varname>ens_rpc_url</varname> (string)</title>
	<para>
		RPC URL for ENS queries. Enables multi-network authentication where 
		ENS is on Ethereum while authentication contracts are on Oasis Sapphire.
		If not set, uses authentication_rpc_url for ENS queries.
	</para>
	<para>
		<emphasis>Common Endpoints:</emphasis>
		<itemizedlist>
			<listitem><para>Ethereum Mainnet: https://mainnet.infura.io/v3/YOUR_KEY</para></listitem>
			<listitem><para>Ethereum Sepolia: https://ethereum-sepolia-rpc.publicnode.com</para></listitem>
		</itemizedlist>
	</para>
	<para>
		<emphasis>Environment Variable:</emphasis> ENS_RPC_URL
	</para>
	<para>
		<emphasis>Default:</emphasis> "https://ethereum-sepolia-rpc.publicnode.com"
	</para>
	<example>
	    <title>ens_rpc_url parameter</title>
	    <programlisting>
modparam("web3_auth_ext", "ens_rpc_url", "https://mainnet.infura.io/v3/YOUR_KEY")
	    </programlisting>
	</example>
    </section>

    <section id="web3_auth_ext.p.ens_registry_address">
	<title><varname>ens_registry_address</varname> (string)</title>
	<para>
		ENS Registry contract address. Standard address on Ethereum mainnet and testnets.
	</para>
	<para>
		<emphasis>Environment Variable:</emphasis> ENS_REGISTRY_ADDRESS
	</para>
	<para>
		<emphasis>Default:</emphasis> "0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"
	</para>
	<example>
	    <title>ens_registry_address parameter</title>
	    <programlisting>
modparam("web3_auth_ext", "ens_registry_address", "0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e")
	    </programlisting>
	</example>
    </section>

    <section id="web3_auth_ext.p.ens_name_wrapper_address">
	<title><varname>ens_name_wrapper_address</varname> (string)</title>
	<para>
		ENS Name Wrapper contract address for wrapped domains. Different addresses 
		on mainnet vs testnets.
	</para>
	<para>
		<emphasis>Network Addresses:</emphasis>
		<itemizedlist>
			<listitem><para>Ethereum Mainnet: 0xD4416b13d2b3a9aBae7AcD5D6C2BbDBE25686401</para></listitem>
			<listitem><para>Ethereum Sepolia: 0x0635513f179D50A207757E05759CbD106d7dFcE8</para></listitem>
		</itemizedlist>
	</para>
	<para>
		<emphasis>Environment Variable:</emphasis> ENS_NAME_WRAPPER_ADDRESS
	</para>
	<para>
		<emphasis>Default:</emphasis> "0x0635513f179D50A207757E05759CbD106d7dFcE8" (Sepolia)
	</para>
	<example>
	    <title>ens_name_wrapper_address parameter</title>
	    <programlisting>
modparam("web3_auth_ext", "ens_name_wrapper_address", "0xD4416b13d2b3a9aBae7AcD5D6C2BbDBE25686401")
	    </programlisting>
	</example>
    </section>

    <section id="web3_auth_ext.p.contract_debug_mode">
	<title><varname>contract_debug_mode</varname> (integer)</title>
	<para>
		Enable debug logging for authentication and ENS operations.
		<emphasis>Warning:</emphasis> May log sensitive authentication data.
	</para>
	<para>
		<emphasis>Values:</emphasis>
		<itemizedlist>
			<listitem><para>0 - Debug disabled</para></listitem>
			<listitem><para>1 - Debug enabled</para></listitem>
		</itemizedlist>
	</para>
	<para>
		<emphasis>Environment Variable:</emphasis> CONTRACT_DEBUG_MODE
	</para>
	<para>
		<emphasis>Default:</emphasis> 1
	</para>
	<example>
	    <title>contract_debug_mode parameter</title>
	    <programlisting>
modparam("web3_auth_ext", "contract_debug_mode", 0)
	    </programlisting>
	</example>
    </section>

    <section id="web3_auth_ext.p.rpc_timeout">
	<title><varname>rpc_timeout</varname> (integer)</title>
	<para>
		Timeout in seconds for RPC calls to blockchain networks. 
		Includes both authentication and ENS queries.
	</para>
	<para>
		<emphasis>Recommended Values:</emphasis>
		<itemizedlist>
			<listitem><para>5-10s - Development/testing</para></listitem>
			<listitem><para>15-30s - Production</para></listitem>
		</itemizedlist>
	</para>
	<para>
		<emphasis>Environment Variable:</emphasis> RPC_TIMEOUT
	</para>
	<para>
		<emphasis>Default:</emphasis> 10
	</para>
	<example>
	    <title>rpc_timeout parameter</title>
	    <programlisting>
modparam("web3_auth_ext", "rpc_timeout", 15)
	    </programlisting>
	</example>
    </section>

    <section id="web3_auth_ext.p.environment_variables">
	<title>Environment Variable Configuration</title>
	<para>
		All parameters can be configured via environment variables for 
		containerized deployments. Environment variables take precedence 
		over modparam configurations.
	</para>
	<example>
	    <title>Complete environment configuration</title>
	    <programlisting>
# Environment variables
AUTHENTICATION_RPC_URL="https://testnet.sapphire.oasis.dev"
AUTHENTICATION_CONTRACT_ADDRESS="0xYourContract"
ENS_RPC_URL="https://ethereum-sepolia-rpc.publicnode.com"
CONTRACT_DEBUG_MODE="0"
RPC_TIMEOUT="15"

# Minimal Kamailio config
loadmodule "auth.so"
loadmodule "web3_auth_ext.so"
	    </programlisting>
	</example>
    </section>

</section> 
</section> 