<!-- Module User's Guide -->

<chapter>

	<title>&adminguide;</title>

	<section id="overview" xreflabel="Overview">
	<title>Overview</title>
	<para>
		This is a module which provides a UNIX/UDP SOCKET transport layer
		implementation for the Management Interface.
	</para>
	</section>

	<section>
	<title>DATAGRAM command syntax</title>
	<para>
		The MI requests and replies follow the
		<ulink url="http://www.jsonrpc.org/specification">JSON-RPC</ulink> syntax.
	</para>
	<para>
		If case of an error generated by the MI engine, mostly internal
		errors, an error message in plain text is sent back in the datagram.
	</para>
	</section>

	<section id="dependencies" xreflabel="Dependencies">
	<title>Dependencies</title>
	<section>
		<title>&osips; Modules</title>
		<para>
		The following modules must be loaded before this module:
			<itemizedlist>
			<listitem>
			<para>
				<emphasis>No dependencies on other &osips; modules</emphasis>.
			</para>
			</listitem>
			</itemizedlist>
		</para>
	</section>
	<section>
		<title>External Libraries or Applications</title>
		<para>
		The following libraries or applications must be installed before
		running &osips; with this module loaded:
			<itemizedlist>
			<listitem>
			<para>
				<emphasis>none</emphasis>
			</para>
			</listitem>
			</itemizedlist>
		</para>
	</section>
	</section>

	<section id="exported_parameters" xreflabel="Exported Parameters">
	<title>Exported Parameters</title>
	<section id="param_socket_name" xreflabel="socket_name">
		<title><varname>socket_name</varname> (string)</title>
		<para>
		The name of a UNIX SOCKET or an IP address.
		The UNIX datagram or UDP socket will be created using this parameter
		in order to read the external commands.
		Both IPv4 and IPv6 are supported.
		</para>
		<para>
		<emphasis>
			Default value is NONE.
		</emphasis>
		</para>
		<example>
		<title>Set <varname>socket_name</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("mi_datagram", "socket_name", "/tmp/opensips.sock")
...
modparam("mi_datagram", "socket_name", "udp:192.168.2.133:8080")
...
</programlisting>
		</example>
	</section>

	<section id="param_children_count" xreflabel="children_count">
		<title><varname>children_count</varname> (string)</title>
		<para>
		The number of child processes to be created. Each child process
		will be a datagram server.
		</para>
		<para>
		<emphasis>
			Default value is 1.
		</emphasis>
		</para>
		<example>
		<title>Set <varname>children_count</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("mi_datagram", "children_count", 3)
...
</programlisting>
		</example>
	</section>

	<section id="param_unix_socket_mode" xreflabel="unix_socket_mode">
		<title><varname>unix_socket_mode</varname> (integer)</title>
		<para>
		Permission to be used for creating the listening UNIX datagram socket.
		Not necessary for a UDP socket.
		It follows the UNIX conventions.
		</para>
		<para>
		<emphasis>
			Default value is 0660 (rw-rw----).
		</emphasis>
		</para>
		<example>
		<title>Set <varname>unix_socket_mode</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("mi_datagram", "unix_socket_mode", 0600)
...
</programlisting>
		</example>
	</section>

	<section id="param_unix_socket_group" xreflabel="unix_socket_group">
		<title><varname>unix_socket_group</varname> (integer)
		<varname>unix_socket_group</varname> (string)</title>
		<para>
		Group to be used for creating the listening UNIX socket.
		</para>
		<para>
		<emphasis>
			Default value is the inherited one.
		</emphasis>
		</para>
		<example>
		<title>Set <varname>unix_socket_group</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("mi_datagram", "unix_socket_group", 0)
modparam("mi_datagram", "unix_socket_group", "root")
...
</programlisting>
		</example>
	</section>

	<section id="param_unix_socket_user" xreflabel="unix_socket_user">
		<title><varname>unix_socket_user</varname> (integer)
		<varname>unix_socket_group</varname> (string)</title>
		<para>
		User to be used for creating the listening UNIX socket.
		</para>
		<para>
		<emphasis>
			Default value is the inherited one.
		</emphasis>
		</para>
		<example>
		<title>Set <varname>unix_socket_user</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("mi_datagram", "unix_socket_user", 0)
modparam("mi_datagram", "unix_socket_user", "root")
...
</programlisting>
		</example>
	</section>

	<section id="param_socket_timeout" xreflabel="socket_timeout">
		<title><varname>socket_timeout</varname> (integer)</title>
		<para>
		The reply will expire after trying to sent it for socket_timeout
		milliseconds.
		</para>
		<para>
		<emphasis>
			Default value is 2000.
		</emphasis>
		</para>
		<example>
		<title>Set <varname>socket_timeout</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("mi_datagram", "socket_timeout", 2000)
...
</programlisting>
		</example>
	</section>

	<section id="param_trace_destination" xreflabel="trace_destination">
		<title><varname>trace_destination</varname> (string)</title>
		<para>
			Trace destination as defined in the tracing module. Currently
		the only tracing module is <emphasis role="bold">proto_hep</emphasis>.
		This is where traced mi messages will go.
		</para>
		<para>
			<emphasis role="bold">WARNING: </emphasis>A tracing module must be
			loaded in order for this parameter to work. (for example
			<emphasis role="bold">proto_hep</emphasis>).
		</para>
		<para>
		<emphasis>
			Default value is none(not defined).
		</emphasis>
		</para>
		<example>
		<title>Set <varname>trace_destination</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("proto_hep", "trace_destination", "[hep_dest]10.0.0.2;transport=tcp;version=3")

modparam("mi_datagram", "trace_destination", "hep_dest")
...
</programlisting>
		</example>
	</section>

	<section id="param_trace_bwlist" xreflabel="trace_bwlist">
		<title><varname>trace_bwlist</varname> (string)</title>
		<para>
			Filter traced mi commands based on a blacklist or a whitelist.
		<emphasis role="bold">trace_destination</emphasis> must be defined for
		this parameter to have any purpose. Whitelists can be defined using
		'w' or 'W', blacklists using 'b' or 'B'. The type is separate by the
		actual blacklist by ':'. The mi commands in the list must be separated
		by ','.
		</para>
		<para>
			Defining a blacklists means all the commands that are not blacklisted
			will be traced. Defining a whitelist means all the commands that are
			not whitelisted will not be traced.
			<emphasis role="bold">WARNING: </emphasis> One can't define both
			a whitelist and a blacklist. Only one of them is allowed. Defining
			the parameter a second time will just overwrite the first one.
		</para>
		<para>
			<emphasis role="bold">WARNING: </emphasis>A tracing module must be
			loaded in order for this parameter to work. (for example
			<emphasis role="bold">proto_hep)</emphasis>.
		</para>
		<para>
		<emphasis>
			Default value is none(not defined).
		</emphasis>
		</para>
		<example>
		<title>Set <varname>trace_destination</varname> parameter</title>
		<programlisting format="linespecific">
...
## blacklist ps and which mi commands
## all the other commands shall be traced
modparam("mi_datagram", "trace_bwlist", "b: ps, which")
...
## allow only sip_trace mi command
## all the other commands will not be traced
modparam("mi_datagram", "trace_bwlist", "w: sip_trace")
...
</programlisting>
		</example>
	</section>

	<section id="param_pretty_printing" xreflabel="pretty_printing">
		<title><varname>pretty_printing</varname> (int)</title>
		<para>
		Indicates whether the JSONRPC responses sent through MI should
		be pretty-printed or not.
		</para>
		<para>
		<emphasis>
			Default value is <quote>0 - no pretty-printing</quote>.
		</emphasis>
		</para>
		<example>
		<title>Set <varname>pretty_printing</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("mi_fifo", "pretty_printing", 1)
...
</programlisting>
		</example>
	</section>



	</section>

	<section id="exported_functions" xreflabel="exported_functions">

	<title>Exported Functions</title>
		<para>
		No function exported to be used from configuration file.
		</para>
	</section>

	<section>
	<title>Example</title>
		<para>
		This is an example showing the DATAGRAM format for the
		<quote>get_statistics dialog: tm:</quote> MI commad:
		request.
		</para>
		<example>
		<title>DATAGRAM request</title>
		<programlisting format="linespecific">

{"jsonrpc":"2.0","method":"get_statistics","id":"1065","params":[["dialog:","tm:"]]}

</programlisting>
		</example>

	</section>


</chapter>

