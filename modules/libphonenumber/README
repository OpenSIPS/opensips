libphonenumber Module
     __________________________________________________________

   Table of Contents

   1. Admin Guide

        1.1. Overview
        1.2. Dependencies

              1.2.1. OpenSIPS Modules
              1.2.2. External Libraries or Applications

        1.3. Exported Functions

              1.3.1. convert_alpha_characters_in_number(number,
                      out)

              1.3.2. format(number, format, out, [default_region])

              1.3.3. format_in_original_format(number,
                      region_calling_from, out, [default_region])

              1.3.4.
                      format_national_number_with_carrier_code(numbe
                      r, carrier_code, out, [default_region])

              1.3.5.
                      format_national_number_with_preferred_carrier_
                      code(number, preferred_carrier_code, out,
                      [default_region])

              1.3.6. format_number_for_mobile_dialing(number,
                      region_calling_from, with_formatting, out,
                      [default_region])

              1.3.7. format_out_of_country_calling_number(number,
                      calling_from, out, [default_region])

              1.3.8.
                      format_out_of_country_keeping_alpha_chars(numb
                      er, calling_from, out, [default_region])

              1.3.9. get_country_code_for_region(region_code, out)

              1.3.10.
                      get_country_mobile_token(country_calling_code
                      , out)

              1.3.11. get_length_of_geographical_area_code(number,
                      out, [default_region])

              1.3.12.
                      get_length_of_national_destination_code(numbe
                      r, out, [default_region])

              1.3.13. get_national_significant_number(number, out,
                      [default_region])

              1.3.14. get_ndd_prefix_for_region(region_code,
                      strip_non_digits, out)

              1.3.15. get_number_type(number, out, default_region)

              1.3.16.
                      get_region_code_for_country_code(country_code
                      , out)

              1.3.17. get_region_code_for_number(number, out,
                      [default_region])

              1.3.18. is_alpha_number(number)
              1.3.19. is_nanpa_country(region_code)
              1.3.20. is_number_match(number1, number2,
                      [default_region1], [default_region2)

              1.3.21. is_possible_number(number, [default_region])

              1.3.22. is_possible_number_for_string(number,
                      region_dialing_from)

              1.3.23. is_valid_number(number, [default_region])
              1.3.24. is_valid_number_for_region(number, region,
                      [default_region])

              1.3.25. normalize_diallable_chars_only(number, out)
              1.3.26. normalize_digits_only(number, out)

   2. Contributors

        2.1. By Commit Statistics
        2.2. By Commit Activity

   3. Documentation

        3.1. Contributors

   List of Tables

   2.1. Top contributors by DevScore^(1), authored commits^(2) and
          lines added/removed^(3)

   2.2. Most recently active contributors^(1) to this module

Chapter 1. Admin Guide

1.1. Overview

   This module allows parsing, formatting, and validating
   international phone numbers using the libphonenumber libarary.

1.2. Dependencies

1.2.1. OpenSIPS Modules

   The following modules must be loaded before this module:
     * None.

1.2.2. External Libraries or Applications

   OpenSIPS libphonenumber support requires the following
   packages:
     * libphonenumber7
     * libphonenumber-dev

1.3. Exported Functions

1.3.1.  convert_alpha_characters_in_number(number, out)

   Converts all alpha characters in a number to their respective
   digits on a keypad, but retains existing formatting.

   Parameters, and return value:
     * number (string)
     * out (var)
     * Return value (integer) - invalid input: -1, success: 1.

1.3.2.  format(number, format, out, [default_region])

   Formats a phone number in the specified format using default
   rules. Note that this does not promise to produce a phone
   number that the user can dial from where they are - although we
   do format in either 'national' or 'international' format
   depending on what the client asks for, we do not currently
   support a more abbreviated format, such as for users in the
   same "area" who could potentially dial the number without area
   code. Note that if the phone number has a country calling code
   of 0 or an otherwise invalid country calling code, we cannot
   work out which formatting rules to apply so we return the
   national significant number with no formatting applied.

   Parameters, and return value:
     * number (string)
     * format (integer):
          + 0 - E164
          + 1 - International
          + 2 - National
          + 3 - RFC3966
     * out (var)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - invalid input: -1, success: 1.

1.3.3.  format_in_original_format(number, region_calling_from, out,
[default_region])

   Formats a phone number using the original phone number format
   (e.g. INTERNATIONAL or NATIONAL) that the number is parsed
   from. Otherwise the number will be formatted in NATIONAL
   format.

   Note this method guarantees no digit will be inserted, removed
   or modified as a result of formatting.

   Parameters, and return value:
     * number (string)
     * region_calling_from (string)
     * out (var)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - invalid input: -1, success: 1.

1.3.4.  format_national_number_with_carrier_code(number,
carrier_code, out, [default_region])

   Formats a phone number in national format for dialing using the
   carrier as specified in the carrier_code. If carrier_code
   contains an empty string, returns the number in national format
   without any carrier code.

   Parameters, and return value:
     * number (string)
     * carrier_code (string)
     * out (var)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - invalid input: -1, success: 1.

1.3.5.  format_national_number_with_preferred_carrier_code(number,
preferred_carrier_code, out, [default_region])

   Formats a phone number in national format for dialing using the
   carrier as specified in the preferred_carrier_code.

   Use format_national_number_with_carrier_code instead if the
   carrier code passed in should take precedence over the number's
   preferred_carrier_code when formatting.

   Parameters, and return value:
     * number (string)
     * preferred_carrier_code (string)
     * out (var)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - invalid input: -1, success: 1.

1.3.6.  format_number_for_mobile_dialing(number, region_calling_from,
with_formatting, out, [default_region])

   Returns a number formatted in such a way that it can be dialed
   from a mobile phone in a specific region. If the number cannot
   be reached from the region (e.g. some countries block toll-free
   numbers from being called outside of the country), the function
   returns -1.

   Parameters, and return value:
     * number (string)
     * region_calling_from (string)
     * with_formatting (integer):
          + 0 - False
          + 1 - True
     * out (var)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - invalid input: -1, success: 1.

1.3.7.  format_out_of_country_calling_number(number, calling_from,
out, [default_region])

   Formats a phone number for out-of-country dialing purposes. If
   no calling_from is supplied, we format the number in its
   INTERNATIONAL format. If the country calling code is the same
   as that of the region where the number is from, then NATIONAL
   formatting will be applied.

   If the number itself has a country calling code of zero or an
   otherwise invalid country calling code, then we return the
   number with no formatting applied.

   Note this function takes care of the case for calling inside of
   NANPA and between Russia and Kazakhstan (who share the same
   country calling code). In those cases, no international prefix
   is used. For regions which have multiple international
   prefixes, the number in its INTERNATIONAL format will be
   returned instead.

   Parameters, and return value:
     * number (string)
     * calling_from (string)
     * out (var)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - invalid input: -1, success: 1.

1.3.8.  format_out_of_country_keeping_alpha_chars(number,
calling_from, out, [default_region])

   Formats a phone number for out-of-country dialing purposes.

   Note that in this version, if the number was entered originally
   using alpha characters and this version of the number is stored
   in raw_input, this representation of the number will be used
   rather than the digit representation. Grouping information, as
   specified by characters such as "-" and " ", will be retained.

   Caveats:
     * This will not produce good results if the country calling
       code is both present in the raw input _and_ is the start of
       the national number. This is not a problem in the regions
       which typically use alpha numbers.
     * This will also not produce good results if the raw input
       has any grouping information within the first three digits
       of the national number, and if the function needs to strip
       preceding digits/words in the raw input before these
       digits. Normally people group the first three digits
       together so this is not a huge problem - and will be fixed
       if it proves to be so.

   Parameters, and return value:
     * number (string)
     * calling_from (string)
     * out (var)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - invalid input: -1, success: 1.

1.3.9.  get_country_code_for_region(region_code, out)

   Returns the country calling code for a specific region. For
   example, this would be 1 for the United States, and 64 for New
   Zealand.

   Parameters, and return value:
     * region_code (string)
     * out (var)
     * Return value (integer) - invalid input: -1, success: 1.

1.3.10.  get_country_mobile_token(country_calling_code, out)

   Returns the mobile token for the provided country calling code
   if it has one, otherwise returns -1. A mobile token is a number
   inserted before the area code when dialing a mobile number from
   that country from abroad.

   Parameters, and return value:
     * country_calling_code (integer)
     * out (var)
     * Return value (integer) - invalid input: -1, success: 1.

1.3.11.  get_length_of_geographical_area_code(number, out,
[default_region])

   Gets the length of the geographical area code from the
   PhoneNumber object passed in, so that clients could use it to
   split a national significant number into geographical area code
   and subscriber number. It works in such a way that the
   resultant subscriber number should be diallable, at least on
   some devices.

   Parameters, and return value:
     * number (string)
     * out (var)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - invalid input: -1, success: 1.

1.3.12.  get_length_of_national_destination_code(number, out,
[default_region])

   Gets the length of the national destination code (NDC) from the
   PhoneNumber object passed in, so that clients could use it to
   split a national significant number into NDC and subscriber
   number. The NDC of a phone number is normally the first group
   of digit(s) right after the country calling code when the
   number is formatted in the international format, if there is a
   subscriber number part that follows.

   Parameters, and return value:
     * number (string)
     * out (var)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - invalid input: -1, success: 1.

1.3.13.  get_national_significant_number(number, out,
[default_region])

   Gets the national significant number of a phone number. Note a
   national significant number doesn't contain a national prefix
   or any formatting.

   Parameters, and return value:
     * number (string)
     * out (var)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - invalid input: -1, success: 1.

1.3.14.  get_ndd_prefix_for_region(region_code, strip_non_digits,
out)

   Returns the national dialling prefix for a specific region. For
   example, this would be 1 for the United States, and 0 for New
   Zealand. Set stripNonDigits to true to strip symbols like "~"
   (which indicates a wait for a dialling tone) from the prefix
   returned. If no national prefix is present, we return null.

   Warning: Do not use this method for do-your-own formatting -
   for some regions, the national dialling prefix is used only for
   certain types of numbers. Use the library's formatting
   functions to prefix the national prefix when required.

   Parameters, and return value:
     * region_code (string)
     * strip_non_digits (integer):
          + 0 - False
          + 1 - True
     * out (var)
     * Return value (integer) - invalid input: -1, success: 1.

1.3.15.  get_number_type(number, out, default_region)

   Gets the type of a valid phone number.

   Parameters, and return value:
     * number (string)
     * out (var):
          + -1 - Parsing error
          + 0 - Fixed line
          + 1 - Mobile
          + 2 - Fixed line or mobile
          + 3 - Toll free
          + 4 - Premium rate
          + 5 - Shared cost
          + 6 - VoIP
          + 7 - Personal number
          + 8 - Pager
          + 9 - UAN
          + 10 - Voicemail
          + 11 - Unknown
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - invalid input: -1, success: 1.

1.3.16.  get_region_code_for_country_code(country_code, out)

   Returns the region code that matches the specific country
   calling code. In the case of no region code being found, ZZ
   will be returned. In the case of multiple regions, the one
   designated in the metadata as the "main" region for this
   calling code will be returned. If the countryCallingCode
   entered is valid but doesn't match a specific region (such as
   in the case of non-geographical calling codes like 800) the
   value "001" will be returned (corresponding to the value for
   World in the UN M.49 schema).

   Parameters, and return value:
     * country_code (integer)
     * out (var)
     * Return value (integer) - invalid input: -1, success: 1.

1.3.17.  get_region_code_for_number(number, out, [default_region])

   Returns the region where a phone number is from. This could be
   used for geocoding at the region level. Only guarantees correct
   results for valid, full numbers (not short-codes, or invalid
   numbers).

   Parameters, and return value:
     * number (string)
     * out (var)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - invalid input: -1, success: 1.

1.3.18.  is_alpha_number(number)

   Checks if the number is a valid vanity (alpha) number such as
   800 MICROSOFT. A valid vanity number will start with at least 3
   digits and will have three or more alpha characters. This does
   not do region-specific checks.

   Parameters, and return value:
     * number (string)
     * Return value (integer) - true: 1, false: -1.

1.3.19.  is_nanpa_country(region_code)

   Checks if this is a region under the North American Numbering
   Plan Administration (NANPA).

   Parameters, and return value:
     * region_code (string)
     * Return value (integer) - true: 1, false: -1.

1.3.20.  is_number_match(number1, number2, [default_region1],
[default_region2)

   Takes two phone numbers and compares them for equality.

   Returns EXACT_MATCH if the country_code, NSN, presence of a
   leading zero for Italian numbers and any extension present are
   the same.

   Returns NSN_MATCH if either or both has no region specified,
   and the NSNs and extensions are the same.

   Returns SHORT_NSN_MATCH if either or both has no region
   specified, or the region specified is the same, and one NSN
   could be a shorter version of the other number. This includes
   the case where one has an extension specified, and the other
   does not.

   Returns NO_MATCH otherwise. For example, the numbers +1 345 657
   1234 and 657 1234 are a SHORT_NSN_MATCH. The numbers +1 345 657
   1234 and 345 657 are a NO_MATCH.

   Parameters, and return value:
     * number1 (string)
     * number2 (string)
     * default_region1 (string, optional) - for number1. Default
       value: "ZZ".
     * default_region2 (string, optional) - for number2. Default
       value: "ZZ".
     * Return value (integer):
          + -1 - Invalid number
          + 1 - No match
          + 2 - Short NSN match
          + 3 - NSN match
          + 4 - Exact match

1.3.21.  is_possible_number(number, [default_region])

   This function returns true if the number is either a possible
   fully-qualified number (containing the area code and country
   code), or if the number could be a possible local number (with
   a country code, but missing an area code). Local numbers are
   considered possible if they could be possibly dialled in this
   format: if the area code is needed for a call to connect, the
   number is not considered possible without it.

   Parameters, and return value:
     * number (string)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - true: 1, false: -1.

1.3.22.  is_possible_number_for_string(number, region_dialing_from)

   Checks whether a phone number is a possible number given a
   number in the form of a string, and the country where the
   number could be dialed from. It provides a more lenient check
   than is_valid_number. See is_possible_number for details.

   This method first parses the number, then invokes
   is_possible_number with the resultant parsed phone number.

   region_dialing_from represents the region that we are expecting
   the number to be dialed from. Note this is different from the
   region where the number belongs. For example, the number +1 650
   253 0000 is a number that belongs to US. When written in this
   form, it could be dialed from any region. When it is written as
   00 1 650 253 0000, it could be dialed from any region which
   uses an international dialling prefix of 00. When it is written
   as 650 253 0000, it could only be dialed from within the US,
   and when written as 253 0000, it could only be dialed from
   within a smaller area in the US (Mountain View, CA, to be more
   specific).

   Parameters, and return value:
     * number (string)
     * region_dialing_from (string)
     * Return value (integer) - true: 1, false: -1.

1.3.23.  is_valid_number(number, [default_region])

   Tests whether a phone number matches a valid pattern. Note this
   doesn't verify the number is actually in use, which is
   impossible to tell by just looking at a number itself. It only
   verifies whether the parsed, canonicalised number is valid: not
   whether a particular series of digits entered by the user is
   diallable from the region provided when parsing. For example,
   the number +41 (0) 78 927 2696 can be parsed into a number with
   country code "41" and national significant number "789272696".
   This is valid, while the original string is not diallable.

   Parameters, and return value:
     * number (string)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - true: 1, false: -1.

1.3.24.  is_valid_number_for_region(number, region, [default_region])

   Tests whether a phone number is valid for a certain region.
   Note this doesn't verify the number is actually in use, which
   is impossible to tell by just looking at a number itself. If
   the country calling code is not the same as the country calling
   code for the region, this immediately exits with false. After
   this, the specific number pattern rules for the region are
   examined. This is useful for determining for example whether a
   particular number is valid for Canada, rather than just a valid
   NANPA number. Warning: In most cases, you want to use
   IsValidNumber instead. For example, this method will mark
   numbers from British Crown dependencies such as the Isle of Man
   as invalid for the region "GB" (United Kingdom), since it has
   its own region code, "IM", which may be undesirable.

   Parameters, and return value:
     * number (string)
     * region (string)
     * default_region (string, optional) - for number. Default
       value: "ZZ".
     * Return value (integer) - true: 1, false: -1.

1.3.25.  normalize_diallable_chars_only(number, out)

   Normalizes a string of characters representing a phone number.
   This strips all characters which are not diallable on a mobile
   phone keypad (including all non-ASCII digits).

   Parameters, and return value:
     * number (string)
     * out (var)
     * Return value (integer) - invalid input: -1, success: 1.

1.3.26.  normalize_digits_only(number, out)

   Normalizes a string of characters representing a phone number.
   This converts wide-ascii and arabic-indic numerals to European
   numerals, and strips punctuation and alpha characters.

   Parameters, and return value:
     * number (string)
     * out (var)
     * Return value (integer) - invalid input: -1, success: 1.

Chapter 2. Contributors

2.1. By Commit Statistics

   Table 2.1. Top contributors by DevScore^(1), authored
   commits^(2) and lines added/removed^(3)
          Name      DevScore Commits Lines ++ Lines --
   1. Bence Szigeti    19       1      2207      0

   (1) DevScore = author_commits + author_lines_added /
   (project_lines_added / project_commits) + author_lines_deleted
   / (project_lines_deleted / project_commits)

   (2) including any documentation-related commits, excluding
   merge commits. Regarding imported patches/code, we do our best
   to count the work on behalf of the proper owner, as per the
   "fix_authors" and "mod_renames" arrays in
   opensips/doc/build-contrib.sh. If you identify any
   patches/commits which do not get properly attributed to you,
   please submit a pull request which extends "fix_authors" and/or
   "mod_renames".

   (3) ignoring whitespace edits, renamed files and auto-generated
   files

2.2. By Commit Activity

   Table 2.2. Most recently active contributors^(1) to this module
          Name        Commit Activity
   1. Bence Szigeti Apr 2023 - Apr 2023

   (1) including any documentation-related commits, excluding
   merge commits

Chapter 3. Documentation

3.1. Contributors

   Last edited by: Bence Szigeti.

   Documentation Copyrights:

   Copyright © 2023 www.opensips-solutions.com
