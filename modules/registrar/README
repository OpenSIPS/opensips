#
# $Id$
#
# Registrar - REGISTER processing logic
#

Module depends on: Usrloc - User location module
                   sl     - For sending stateless replies


Exported parameters:
-------------------

Name:    default_expires
Type:    integer
Default: 3600
Desc:    If the processed message contains neither Expires HFs nor
         expires contact parameters, this value will be used
         for newly created usrloc records. The parameter contains
         number of second to expire (for example use 3600 for one hour).


Name:    default_q
Type:    integer
Default: 0
Desc:    The parameter represents default q value for new contacts. Because
         ser doesn't support float parameter types, the value in the parameter
         is divided by 100 and stored as float. For example, if you want default_q
         to be 0.38, use value 38 here.


Name:    append_branches
Type:    integer
Default: 1
Desc:    The parameter controls how lookup function processes multiple contacts.
         If there are multiple contacts for the given username in usrloc and this
         parametr is set to 1, Request-URI will be overwritten with the highest-q
         rated contact and the rest will be appended to sip_msg structure and can 
         be later used by tm for forking. If the parameter is set to 0, only 
         Request-URI will be overwritten with the highest-q rated contact and the 
         rest will be left unprocessed.  

Name:    append_branches
Type:    integer
Default: 1
Desc:    When the registar finds more than one contacts for a particular user
         it will put the first one into the Request-URI and append other to the
	 message so that tm can use them for forking. If this parameter is set 0
	 then only the Request-URI will be rewritten and other contacts will be
	 omitted.

Name:    use_domain
Type:    integer
Default: 0
Desc:    If set to 1 then the registrar will use username@domain as address of record.
         If the variable is set to 0 then only username will be used as the address
	 of record.

Name:    case_sensitive
Type:    integer
Default: 0
Desc:    If set to 1 then AOR comparison will be case sensitive, if set to 0 then
         AOR comparison will be case insensitive -- This is recommended.
	 
Name:    desc_time_order
Type:    integer
Default: 0
Desc:    If set to 1 then all contacts will be ordered in descending modification
         time order. In this case the most recently updated/created contact will
	 be used.


Exported Functions:
------------------

Name:   save
Params: domain - Logical domain within registrar. If dababase is used then this must
        be name of the table which stores the contacts.
Desc:   The function processes a REGISTER message. It can add, remove or modify
        usrloc records depending on Contact and Expires HFs in the REGISTER message.
        On success, 200 OK will be returned listing all contacts that are currently
        in usrloc. On an error, error message will be send with a short description
        in reason phrase.

Name:   save_noreply
Params: domain - Logical domain within registar. If database is used then this must
        be na e of the table which stores the contacts.
Desc:   Same as save() but it doesn't send a reply.

Name:   lookup
Params: table - Name of table that should be used for the lookup
Desc:   The functions extracts username from Request-URI and tries to find all contacts
        for the username in usrloc. If there are no such contacts, -1 will be returned.
        If there are such contacts, Request-URI will be overwritten with the contact that
        has the highest q value and optionally the rest will be appended to the message
        (depending on append_branches parameter value).
