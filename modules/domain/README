#
# README of domain module -- Juha Heinanen Dec 29, 2002
#

Domain module implements checks that based on domain table determine if
a host part of an URI is "local" or not.  A "local" domain is one that
the proxy is responsible for.

Domain module operates in caching or non-caching mode depending on value
of module parameter db_mode.  In caching mode domain module reads the
contents of domain table into cache memory when the module is loaded.
After that domain table is re-read only when module is given
domain_reload fifo command.  Any changes in domain table must thus be
followed by domain_reload command in order to reflect them in module
behavior.  In non-caching mode domain module always queries domain table
in the database.

Caching is implemented using a hash table.  The size of the hash table
is given by HASH_SIZE constant defined in domain_mod.h.  Its "factory
default" value is 128.


Depends on:
----------

mysql

Exported parameters:
-------------------

Name:	 db_url
Type:    string
Default: "sql://serro:47serro11@localhost/ser"
Desc:    URL for accessing the database.

Name:	 db_mode
Type:    int
Default: 0
Desc:    Database usage mode: 0 = non-caching, 1 = caching

Name:	 domain_table
Type:    string
Default: "domain"
Desc:    Name of table containing names of local domains that the proxy
	 is responsible for.  Local users must have in their sip uri a
	 host part that is equal to one of these domains.

Name:	 domain_column
Type:	 string
Default: "domain"
Desc:	 Name of column containing domains in domain table

Exported Functions:
------------------

Name:	is_from_local
Params:	-
Desc:	Checks based on domain table if host part of From header uri is
	one of the local domains that the proxy is responsible for

Name:	is_uri_host_local
Params:	-
Desc:	Checks based on domain table if request uri belongs to one of the
	local domains

Fifo Commands:
-------------

Name:	domain_reload
Params: -
Desc:	Causes domain module to re-read the contents of domain table
	into cache memory.

Name:	domain_dump
Params: -
Desc:	Causes domain module to dump hash indexes and domain names in
	its cache memory.


Known Limitations
-----------------

There is an unlikely race condition on domain list update.
If a process uses a table, which is reloaded at the same 
time twice through FIFO, the second reload will delete the
original table still in use by the process.
